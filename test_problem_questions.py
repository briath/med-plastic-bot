#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
"""

import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from services.openai_service import openai_service


async def test_problem_questions():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞"""
    
    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤...\n")
    
    # –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
    test_questions = [
        "–∫–∞–∫–∞—è —Å—Ç–æ–ª–∏—Ü–∞ —É –ü–∞—Ä–∏–∂–∞?",
        "–ö–∞–∫–∞—è –ø–ª–æ—â–∞–¥—å –∞—Ñ—Ä–∏–∫–∏?",
        "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2+2?",
        "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
        "–ß—Ç–æ —Ç–∞–∫–æ–µ –±–ª–µ—Ñ–∞—Ä–æ–ø–ª–∞—Å—Ç–∏–∫–∞?",
    ]
    
    for i, question in enumerate(test_questions, 1):
        print(f"üìù –í–æ–ø—Ä–æ—Å {i}: {question}")
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞
            context = {'history': []}  # –ü—É—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
            response = await openai_service.generate_response(question, context)
            
            if response:
                print(f"‚úÖ –û—Ç–≤–µ—Ç: {response}")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã
                problems = []
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ "–ê–Ω–Ω–∞:" –≤ –Ω–∞—á–∞–ª–µ
                if response.startswith("–ê–Ω–Ω–∞:"):
                    problems.append("‚ùå –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '–ê–Ω–Ω–∞:'")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–ª–∞—Å—Ç–∏–∫–∏ –≤ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö
                if "–ø–ª–∞—Å—Ç–∏–∫" in response.lower() and "–±–ª–µ—Ñ–∞—Ä–æ–ø–ª–∞—Å—Ç–∏–∫–∞" not in question.lower():
                    problems.append("‚ùå –£–ø–æ–º—è–Ω—É–ª–∞ –ø–ª–∞—Å—Ç–∏–∫—É –≤ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–º –≤–æ–ø—Ä–æ—Å–µ")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–º–æ—â–∏
                if "–ø–æ–º–æ—á—å" in response.lower() or "–ø–æ–º–æ–≥—É" in response.lower():
                    problems.append("‚ùå –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–º–æ—â—å")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
                if len(response) > 200:
                    problems.append(f"‚ùå –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç ({len(response)} —Å–∏–º–≤–æ–ª–æ–≤)")
                
                if problems:
                    for problem in problems:
                        print(problem)
                else:
                    print("‚úÖ –û—Ç–≤–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π")
            else:
                print("‚ùå –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞")
                
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        print("-" * 60)
    
    print("\nüéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")


if __name__ == "__main__":
    asyncio.run(test_problem_questions())
